name: provision t2.micro EC2 instance

on:
  workflow_dispatch:
    inputs:
      ec2_name:
        description: 'Name of the EC2 instance'
        required: true
        default: "App Server"
        type: string

jobs:
  provision-ec2::
    runs-on: linux-latest
    steps:
      -uses: actions/checkout@v3
      -uses: actions/setup-node@v3
        with:
          node-version: '18'
      -name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-id: '${{ secrets.TF_USER_AWS_KEY }}' 
          aws-secret-access-key: '${{ secrets.TF_USER_AWS_SECRET }}'
          aws-region: us-east-1
        -name: Setup Terraform
        uses: hashicorp/setup-terraform@v1
        with:
          terraform_wrapper: false
        -name: Terraform Apply 
          id: Apply
          env:  
            TF_VAR_ec2_name: ${{ github.event.inputs.ec2_name }}
          run: |
            terraform init
            terraform validate
            terraform plan
            terraform apply -auto-approve

